<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta http-equiv="Cache-Control" content="no-cache" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
    <meta name="MobileOptimized" content="240" />
    <meta name="apple-touch-fullscreen" content="YES" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta content="telephone=no" name="format-detection" />  
    <meta content="email=no" name="format-detection" />
    <!-- uc强制竖屏 -->
    <meta name="screen-orientation" content="portrait">
    <!-- QQ强制竖屏 -->
    <meta name="x5-orientation" content="portrait">
    <!-- UC强制全屏 -->
    <meta name="full-screen" content="yes">
    <!-- QQ强制全屏 -->
    <meta name="x5-fullscreen" content="true">
    <!-- UC应用模式 -->
    <meta name="browsermode" content="application">
    <!-- QQ应用模式 -->
    <meta name="x5-page-mode" content="app">
    <!-- windows phone 点击无高光 -->
    <meta name="msapplication-tap-highlight" content="no">
    <!-- 适应移动端end -->
    <title>武汉佛罗伦萨小镇奥莱“奇幻丛林”盛大开幕，价值180元亲子套票限免，速抢！</title>
    <link rel="stylesheet" href="css/base.css">
    <style>
       .main-wrap{width: 100%; max-width: 750px; margin:0 auto; font-size: 0;} 
       .bg01{margin-top: -1px; background: url(images/bg01.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 54.9rem; position: relative;}
       .bg02{margin-top: -1px; background: url(images/bg02.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 49.15rem;}
       .bg03{margin-top: -1px; background: url(images/bg03.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 47.1rem;}
       .bg04{margin-top: -1px; background: url(images/bg04.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.35rem;}
       .bg05{margin-top: -1px; background: url(images/bg05.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.4rem;}
       .bg06{margin-top: -1px; background: url(images/bg06.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.35rem;}
       .bg07{margin-top: -2px; background: url(images/bg07.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.4rem;}
       .bg08{margin-top: -1px; background: url(images/bg08.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.35rem;}
       .bg09{margin-top: -2px; background: url(images/bg09.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.4rem;}
       .bg10{margin-top: -1px; background: url(images/bg10.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.4rem;}
       .bg11{margin-top: -1px; background: url(images/bg11.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.35rem;}
       .bg12{margin-top: -2px; background: url(images/bg12.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.4rem;}
       .bg13{margin-top: -1px; background: url(images/bg13.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.35rem;}
       .bg14{margin-top: -1px; background: url(images/bg14.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.4rem;}
       .bg15{margin-top: -1px; background: url(images/bg15.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.35rem;}
       .bg16{margin-top: -2px; background: url(images/bg16.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.4rem;}
       .bg17{margin-top: -1px; background: url(images/bg17.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.35rem;}
       .bg18{margin-top: -2px; background: url(images/bg18.jpg)center top no-repeat; background-size: contain; width: 37.5rem; height: 50.4rem;}
       .get-btn{width: 22.5rem;height: 7rem; background: url(images/btn2.png) center top no-repeat; background-size: contain; position: absolute; bottom: 8.5rem; left: 50%;  margin-left: -11.25rem;}
       .get-btn.successed{background: url(images/btn.png) center top no-repeat; background-size: contain;}
       .code-box{width: 33.2rem;height: 5rem; background: url(images/code_box.png) center top no-repeat; background-size: contain; position: absolute; bottom: 2.7rem; left: 50%; margin-left: -16.6rem;  padding: .3rem .6rem .8rem 5.8rem;}
       .code-box span{width: 100%; height: 100%; display: block; line-height: 3.9rem; font-size: 2rem; color:#000000; font-weight: bold; letter-spacing:.6rem; text-align: center;}
       .black-bg{background: url(images/black_bg.png); width: 100%; height: 100%; position: fixed; left: 0; top: 0;z-index: 1000; display: none;}
       .pop-box{background: url(images/pop_box.png) center top no-repeat; background-size: contain; width: 22.8rem; height: 19.9rem; position: fixed; left: 50%; top: 50%; margin-left: -11.9rem; margin-top: -9.95rem; z-index: 1001; display: none;}
       .flex-end{ justify-content:flex-end; width: 100%; height: 2.5rem; display: flex;}
       .pop-con{ width: 19.1rem;display: flex; flex-direction: column; margin:.85rem auto 0 auto;}
       .pop-box .close-btn{width: 2.5rem; height: 2.5rem;}
       .pop-con .tel input{border:1px solid #c3c4c4; line-height: 2.4rem; height: 2.4rem; border-radius: .8rem; width: 100%; text-align: center;font-size: 1rem;-webkit-appearance: none;}
       .yzm-code{display: flex; flex-direction: row; justify-content: space-between; margin-top: 1.7rem; height: 2.4rem;}
       .yzm-code input{border:1px solid #c3c4c4; line-height: 2.4rem; height: 2.4rem; border-radius: .8rem; width: 12.5rem; text-align: center; font-size: 1rem;-webkit-appearance: none;}
       .yzm-code .get-code{width: 6rem; height: 1.75rem; line-height: 1.75rem; margin-top: .325rem;  display: block;background-color: #9fa0a0; font-size: .9rem; color: #FFF;text-align: center; border-radius: .8rem;}
       .submit-btn{margin:2.45rem auto 0 auto; width: 13.2rem; height: 4.2rem; cursor: pointer;}
       .prompt{text-align: center;width: 90%;position: fixed;margin: auto;left: 0;right: 0;top: 40%;z-index: 10001;display: none;}
       .prompt em{display: inline-block;background: rgba(0,0,0,0.75);padding: .75rem 1.25rem;border-radius: 2.5rem;color: #FFF;font-size: 1.6rem;line-height: 2.4rem;}
    </style>
</head>
<body>
    <div class="main-wrap">
       <div class="bg01">
         <div class="get-btn"></div>
         <div class="code-box"><span></span></div>
       </div>
       <div class="bg02"></div>
       <div class="bg03"></div>
       <div class="bg04"></div>
       <div class="bg05"></div>
       <div class="bg06"></div>
       <div class="bg07"></div>
       <div class="bg08"></div>
       <div class="bg09"></div>
       <div class="bg10"></div>
       <div class="bg11"></div>
       <div class="bg12"></div>
       <div class="bg13"></div>
       <div class="bg14"></div>
       <div class="bg15"></div>
       <div class="bg16"></div>
       <div class="bg17"></div>
       <div class="bg18"></div>
    </div>
<div class="prompt" id="prompt"><em>提示信息</em></div>
<div class="black-bg"></div>
<div class="pop-box">
  <div class="flex-end">
    <div class="close-btn"></div>
  </div>
  <div class="pop-con">
    <div class="tel"><input type="tel" maxlength="11" pattern="[0-9]*" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" placeholder="填写手机号码"></div>
    <div class="yzm-code">
      <input type="text" placeholder="输入验证码">
      <span class="get-code">发送验证码</span>
    </div>
    <div class="submit-btn"></div>
  </div>
</div>
<script src="js/zepto.min.js"></script>
<script src='http://cmsfile.wifi8.com/uploads/wifi/AppH5/api/nfygCommonPack.min.js'></script>
<!-- <script src="js/vconsole.min.js"></script> -->
<script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
<script src="js/public.js?v=3"></script>
<script>
    $(function(){
        var basePath = 'http://activity.peanut8.com';

        var url = 'http://activity.peanut8.com/act/2019/foluo/index.html';
        var imgUrl = 'http://activity.peanut8.com/act/2019/foluo/images/share.jpg';
        var title = '武汉佛罗伦萨小镇奥莱“奇幻丛林”盛大开幕，价值180元亲子套票限免，速抢！';
        var desc = '武汉佛罗伦萨小镇奥莱“奇幻丛林”盛大开幕，价值180元亲子套票限免，速抢！';
        var wx_url = window.location.href;
        $.ajax({
          type: "get",
          url: 'http://activity.peanut8.com/WxShare/anxious',
          data: {
            url: wx_url
          },
          dataType: 'json',
          success: function(data) {
            if(data.code == 1) {
              wx.config({
                debug: false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
                appId: data.data.sharePackage.appId, // 必填，公众号的唯一标识
                timestamp: data.data.sharePackage.timestamp, // 必填，生成签名的时间戳
                nonceStr: data.data.sharePackage.nonceStr, // 必填，生成签名的随机串
                signature: data.data.sharePackage.signature, // 必填，签名，见附录1
                jsApiList: [
                  'checkJsApi',
                  'onMenuShareTimeline',
                  'onMenuShareAppMessage'
                ] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
              });
              var shareInfo = data.data.shareInfo;
              wx.ready(function() {
                //分享到朋友圈
                wx.onMenuShareTimeline({
                  title: title, // 分享标题
                  desc: desc,
                  link: url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                  imgUrl: imgUrl, // 分享图标
                  success: function() {

                  },
                  cancel: function(res) {

                  }
                });

                //分享给朋友
                wx.onMenuShareAppMessage({
                  title: title, // 分享标题
                  desc: desc, // 分享描述
                  link: url, // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                  imgUrl: imgUrl, // 分享图标
                  success: function() {

                  },
                  cancel: function() {

                  }
                });
              });
            }
          },
          error: function() {}
        })


        //获取短信验证码
         var validCode=true;
         $(".get-code").click (function () {
          var tel = $(".tel input").val();
          var time=60;
          var $this=$(this);
          if (validCode) {
            validCode=false;
            $.ajax({
              type: "post",
              url: basePath+'/hx/send',
              data:{"tel":tel},
              dataType: 'json',
              success: function(data) {
                  if(data.code==1){
                    var t=setInterval(function () {
                      time--;
                      $this.html(time+"s");
                      if (time==0) {
                       clearInterval(t);
                       $this.html("发送验证码");
                       validCode=true;
                      }
                     },1000)
                  }else{
                    promptShow(data.msg);
                  }
              }
            });
           
          }
         })

        //关闭弹窗
        $(".close-btn").click(function(){
            $(".black-bg,.pop-box").hide();
        });

        if(mobile != '' && mobile != null && mobile != undefined){
            getUserCoupon(mobile);
        }
        $('.get-btn').click(function(){
            if($(this).hasClass('successed')){
                return;
            }
            if(!isApp){
                // promptShow('请前往 “花生地铁” app 内领取');
                $(".black-bg,.pop-box").show();
                return;
            }
            if(mobile == '' || mobile == null || mobile == undefined){
                promptShow('登录后才能领取哦~');
                return;
            }
            nfyg.encrypt(mobile, function (res) {
              receiveCoupon(res,0);
            });

        })

        $('.submit-btn').click(function(){
           var mobile = $(".tel input").val();
           var code = $(".yzm-code input").val();
            if(!$(this).hasClass('disabled')){
              $(this).addClass("disabled");
              receiveCoupon(mobile,1,code);
            }
        })
        
    function getUserCoupon(tel){
            $.ajax({
                url: basePath + '/hx/getUserCoupon',
                type: 'post',
                dataType: 'json',
                data: {'tel': tel},
                success: function(data) {
                    if(data.code == 1){
                        $('.code-box span').text(data.msg);
                        $('.get-btn').addClass("successed");
                    }
                }
            });
        }
        function receiveCoupon(tel,type,code){
            $.ajax({
                url: basePath + '/hx/receiveCoupon',
                type: 'post',
                dataType: 'json',
                data: {'tel': tel, 'type': type,'code':code},
                success: function(data){
                  $(".submit-btn").removeClass("disabled");
                    if(data.code == 1){
                        $('.code-box span').text(data.data.coupon);
                        $('.get-btn').addClass("successed");
                        localStorage.setItem("nfyg_mobile", data.data.userId);
                        $(".black-bg,.pop-box").hide();
                    }else{
                      promptShow(data.msg);
                    }
                }
            });
        }
    })



</script>
<script>
    
</script>
</body>
</html>