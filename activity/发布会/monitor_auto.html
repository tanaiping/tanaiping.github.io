
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>花生地铁行为引擎</title>
	<link rel="stylesheet" href="css/base.css" />
	<link rel="stylesheet" href="css/main.css?11" />
	<link rel="stylesheet" href="css/subway.css" />
	<script type="text/javascript" src="js/api.js"></script>
</head>
<body>
<div class="main-bg" style="min-height: 1650px;"><!--style="height: 1650px;" -->
    <div class="parallax"><div class="layer"></div></div>
	<!-- header start  -->
	<div class="header">
		<div class="main-wrap clearfix">
			<div class="fl logo">花生地铁行为引擎</div>
			<div class="fr menu-list">
				<a href="index.html" class="m01">首页</a>
				<a href="flow.html" class="m02">地铁流量图</a>
				<a href="user_monitor.html" class="m03 act">用户行为轨迹</a>
				<a href="echarts.html" class="m04">人群流向图</a>
		        <a href="javascript:;" class="m05 unabled">站厅热力图</a>
		        <a href="javascript:;" class="m06 unabled">灯箱广告监测</a>
		        <a href="javascript:;" class="m07 unabled">数据接口</a>
			</div>
		</div>
	</div>
	<!-- header end  -->
	<div class="main-wrap">
		<div class="hot-app" style="display: none;">
			<div class="tel-box">
				<div class="input-box"><input type="text" id="phone" maxlength="11" pattern="[0-9]*" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" placeholder="手机号" /></div>
				<a href="javascript:;" class="submit-btn">确认</a>
			</div>
			<div class="hotList-wrap fl-start" id="TabMain">
				<div class="hotList-left"> 
					<div class="hotList-title">实时热门榜</div>
					<ul class="tabItemContainer">
						<li class="tabItemCurrent"><a>热门App</a></li>
				        <li><a>热门Url</a></li>
				        <!--li><a>热门关键词</a></li-->
					</ul>
				</div>
				<div class="tabBodyContainer">
					<div class="tabBodyItem tabBodyCurrent ">
			            <table id="app">
			            	
			            </table>
			        </div>
			        <div class="tabBodyItem">
			           <table id="url">
			 
			            </table>
			        </div>
				</div>
			</div>

		</div>
		<!-- 热门APP END -->
		<div class="daily-action" style="display: block;">
			<h3 class="tc"><span  style="background: none">用户：<em id="tel_change"></em>最近每天的行为特征</span></h3>
			<div class="times clearfix">
				<span tag="6">6:00</span>
				<span tag="7">7:00</span>
				<span tag="8">8:00</span>
				<span tag="9">9:00</span>
				<span tag="10">10:00</span>
				<span tag="11">11:00</span>
				<span tag="12">12:00</span>
				<span tag="13">13:00</span>
				<span tag="14">14:00</span>
				<span tag="15">15:00</span>
				<span tag="16">16:00</span>
				<span tag="17">17:00</span>
				<span tag="18">18:00</span>
				<span tag="19">19:00</span>
				<span tag="20">20:00</span>
				<span tag="21">21:00</span>
				<span tag="22">22:00</span>
				<span tag="23">23:00</span>
			</div>
			<div class="tel-tag">
				<div class="tel-version"><em>手机型号</em>&nbsp;</div>
				<div class="tel-interest"><em>兴趣爱好</em>&nbsp;</div>
			</div>
			<div class="btn-box clearfix">
				<a href="javascript:;" class="play-btn fl pause-btn"><span>暂停</span></a>
			</div>
			<div class="subway-con02 ">
				<div class="subway-wrap subway2">
					<canvas id="myCanvas" width="1288px" height="1178px" style="display: none;">
					您的浏览器不支持canvas标签。
					</canvas>
					<div class="s1-1 station" station-name="富锦路"></div>
					<div class="s1-2 station" station-name="友谊西路"></div>
					<div class="s1-3 station" station-name="宝安公路"></div>
					<div class="s1-4 station" station-name="共富新村"></div>
					<div class="s1-5 station" station-name="呼兰路"></div>
					<div class="s1-6 station" station-name="通河新村"></div>
					<div class="s1-7 station" station-name="共康路"></div>
					<div class="s1-8 station" station-name="彭浦新村"></div>
					<div class="s1-9 station" station-name="汶水路"></div>
					<div class="s1-10 station" station-name="上海马戏城"></div>
					<div class="s1-11 station" station-name="延长路"></div>
					<div class="s1-12 station" station-name="中山北路"></div>
					<div class="s1-13 station" station-name="上海火车站"></div>
					<div class="s1-14 station" station-name="汉中路"></div>
					<div class="s1-15 station" station-name="新闸路"></div>
					<div class="s1-16 station" station-name="人民广场"></div>
					<div class="s1-17 station" station-name="黄陂南路"></div>
					<div class="s1-18 station" station-name="陕西南路"></div>
					<div class="s1-19 station" station-name="常熟路"></div>
					<div class="s1-20 station" station-name="衡山路"></div>
					<div class="s1-21 station" station-name="徐家汇"></div>
					<div class="s1-22 station" station-name="上海体育馆"></div>
					<div class="s1-23 station" station-name="漕宝路"></div>
					<div class="s1-24 station" station-name="上海南站"></div>
					<div class="s1-25 station" station-name="锦江乐园"></div>
					<div class="s1-26 station" station-name="莲花路"></div>
					<div class="s1-27 station" station-name="外环路"></div>
					<div class="s1-28 station" station-name="莘庄"></div>

					<div class="s2-1 station" station-name="徐泾东"></div>
					<div class="s2-2 station" station-name="虹桥火车站"></div>
					<div class="s2-3 station" station-name="虹桥2号航站楼"></div>
					<div class="s2-4 station" station-name="淞虹路"></div>
					<div class="s2-5 station" station-name="北新泾"></div>
					<div class="s2-6 station" station-name="威宁路"></div>
					<div class="s2-7 station" station-name="娄山关路"></div>
					<div class="s2-8 station" station-name="中山公园"></div>
					<div class="s2-9 station" station-name="江苏路"></div>
					<div class="s2-10 station" station-name="静安寺"></div>
					<div class="s2-11 station" station-name="南京西路"></div>
					<div class="s2-12 station" station-name="南京东路"></div>
					<div class="s2-13 station" station-name="陆家嘴"></div>
					<div class="s2-14 station" station-name="东昌路"></div>
					<div class="s2-15 station" station-name="世纪大道"></div>
					<div class="s2-16 station" station-name="上海科技馆"></div>
					<div class="s2-17 station" station-name="世纪公园"></div>
					<div class="s2-18 station" station-name="龙阳路"></div>
					<div class="s2-19 station" station-name="张江高科"></div>
					<div class="s2-20 station" station-name="金科路"></div>
					<div class="s2-21 station" station-name="广兰路"></div>
					<div class="s2-22 station" station-name="唐镇"></div>
					<div class="s2-23 station" station-name="创新中路"></div>
					<div class="s2-24 station" station-name="华夏东路"></div>
					<div class="s2-25 station" station-name="川沙"></div>
					<div class="s2-26 station" station-name="凌空路"></div>
					<div class="s2-27 station" station-name="远东大道"></div>
					<div class="s2-28 station" station-name="海天三路"></div>
					<div class="s2-29 station" station-name="浦东国际机场"></div>

					<div class="s3-1 station" station-name="江杨北路"></div>
					<div class="s3-2 station" station-name="铁力路"></div>
					<div class="s3-3 station" station-name="友谊路"></div>
					<div class="s3-4 station" station-name="宝杨路"></div>
					<div class="s3-5 station" station-name="水产路"></div>
					<div class="s3-6 station" station-name="淞滨路"></div>
					<div class="s3-7 station" station-name="张华浜"></div>
					<div class="s3-8 station" station-name="淞发路"></div>
					<div class="s3-9 station" station-name="长江南路"></div>
					<div class="s3-10 station" station-name="殷高西路"></div>
					<div class="s3-11 station" station-name="江湾镇"></div>
					<div class="s3-12 station" station-name="大柏树"></div>
					<div class="s3-13 station" station-name="赤峰路"></div>
					<div class="s3-14 station" station-name="虹口足球场"></div>
					<div class="s3-15 station" station-name="东宝兴路"></div>
					<div class="s3-16 station" station-name="宝山路"></div>
					<div class="s3-17 station" station-name="中潭路"></div>
					<div class="s3-18 station" station-name="镇坪路"></div>
					<div class="s3-19 station" station-name="曹杨路"></div>
					<div class="s3-20 station" station-name="金沙江路"></div>
					<div class="s3-21 station" station-name="延安西路"></div>
					<div class="s3-22 station" station-name="虹桥路"></div>
					<div class="s3-23 station" station-name="宜山路"></div>
					<div class="s3-24 station" station-name="漕溪路"></div>
					<div class="s3-25 station" station-name="龙漕路"></div>
					<div class="s3-26 station" station-name="石龙路"></div>

					<div class="s4-1 station" station-name="上海体育场"></div>
					<div class="s4-2 station" station-name="东安路"></div>
					<div class="s4-3 station" station-name="大木桥路"></div>
					<div class="s4-4 station" station-name="鲁班路"></div>
					<div class="s4-5 station" station-name="西藏南路"></div>
					<div class="s4-6 station" station-name="南浦大桥"></div>
					<div class="s4-7 station" station-name="塘桥"></div>
					<div class="s4-8 station" station-name="蓝村路"></div>
					<div class="s4-9 station" station-name="浦电路"></div>
					<div class="s4-10 station" station-name="浦东大道"></div>
					<div class="s4-11 station" station-name="杨树浦路"></div>
					<div class="s4-12 station" station-name="大连路"></div>
					<div class="s4-13 station" station-name="临平路"></div>
					<div class="s4-14 station" station-name="海伦路"></div>

					<div class="s5-1 station" station-name="春申路"></div>
					<div class="s5-2 station" station-name="银都路"></div>
					<div class="s5-3 station" station-name="颛桥"></div>
					<div class="s5-4 station" station-name="北桥"></div>
					<div class="s5-5 station" station-name="剑川路"></div>
					<div class="s5-6 station" station-name="东川路"></div>
					<div class="s5-7 station" station-name="金平路"></div>
					<div class="s5-8 station" station-name="华宁路"></div>
					<div class="s5-9 station" station-name="文井路"></div>
					<div class="s5-10 station" station-name="闵行开发区"></div>

					<div class="s6-1 station" station-name="港城路"></div>
					<div class="s6-2 station" station-name="外高桥保税区北"></div>
					<div class="s6-3 station" station-name="航津路"></div>
					<div class="s6-4 station" station-name="外高桥保税区南"></div>
					<div class="s6-5 station" station-name="洲海路"></div>
					<div class="s6-6 station" station-name="五洲大道"></div>
					<div class="s6-7 station" station-name="东靖路"></div>
					<div class="s6-8 station" station-name="五莲路"></div>
					<div class="s6-9 station" station-name="博兴路"></div>
					<div class="s6-10 station" station-name="金桥路"></div>
					<div class="s6-11 station" station-name="云山路"></div>
					<div class="s6-12 station" station-name="德平路"></div>
					<div class="s6-13 station" station-name="北洋泾路"></div>
					<div class="s6-14 station" station-name="民生路"></div>
					<div class="s6-15 station" station-name="源深体育中心"></div>
					<div class="s6-16 station" station-name="浦电路"></div>
					<div class="s6-17 station" station-name="上海儿童医学中心"></div>
					<div class="s6-18 station" station-name="临沂新村"></div>
					<div class="s6-19 station" station-name="高科西路"></div>
					<div class="s6-20 station" station-name="东明路"></div>
					<div class="s6-21 station" station-name="高青路"></div>
					<div class="s6-22 station" station-name="华夏西路"></div>
					<div class="s6-23 station" station-name="上南路"></div>
					<div class="s6-24 station" station-name="灵岩南路"></div>

					<div class="s7-1 station" station-name="美兰湖"></div>
					<div class="s7-2 station" station-name="罗南新村"></div>
					<div class="s7-3 station" station-name="潘广路"></div>
					<div class="s7-4 station" station-name="刘行"></div>
					<div class="s7-5 station" station-name="顾村公园"></div>
					<div class="s7-6 station" station-name="祁华路"></div>
					<div class="s7-7 station" station-name="上海大学"></div>
					<div class="s7-8 station" station-name="南陈路"></div>
					<div class="s7-9 station" station-name="上大路"></div>
					<div class="s7-10 station" station-name="场中路"></div>
					<div class="s7-11 station" station-name="大场镇"></div>
					<div class="s7-12 station" station-name="行知路"></div>
					<div class="s7-13 station" station-name="大华三路"></div>
					<div class="s7-14 station" station-name="新村路"></div>
					<div class="s7-15 station" station-name="岚皋路"></div>
					<div class="s7-16 station" station-name="长寿路"></div>
					<div class="s7-17 station" station-name="昌平路"></div>
					<div class="s7-18 station" station-name="肇嘉浜路"></div>
					<div class="s7-19 station" station-name="龙华中路"></div>
					<div class="s7-20 station" station-name="后滩"></div>
					<div class="s7-21 station" station-name="长清路"></div>
					<div class="s7-22 station" station-name="耀华路"></div>
					<div class="s7-23 station" station-name="云台路"></div>
					<div class="s7-24 station" station-name="杨高南路"></div>
					<div class="s7-25 station" station-name="锦绣路"></div>
					<div class="s7-26 station" station-name="芳华路"></div>
					<div class="s7-27 station" station-name="花木路"></div>

					<div class="s8-1 station" station-name="市光路"></div>
					<div class="s8-2 station" station-name="嫩江路"></div>
					<div class="s8-3 station" station-name="翔殷路"></div>
					<div class="s8-4 station" station-name="黄兴公园"></div>
					<div class="s8-5 station" station-name="延吉中路"></div>
					<div class="s8-6 station" station-name="黄兴路"></div>
					<div class="s8-7 station" station-name="江浦路"></div>
					<div class="s8-8 station" station-name="鞍山新村"></div>
					<div class="s8-9 station" station-name="四平路"></div>
					<div class="s8-10 station" station-name="曲阳路"></div>
					<div class="s8-11 station" station-name="西藏北路"></div>
					<div class="s8-12 station" station-name="中兴路"></div>
					<div class="s8-13 station" station-name="曲阜路"></div>
					<div class="s8-14 station" station-name="大世界"></div>
					<div class="s8-15 station" station-name="老西门"></div>
					<div class="s8-16 station" station-name="陆家浜路"></div>
					<div class="s8-17 station" station-name="中华艺术宫"></div>
					<div class="s8-18 station" station-name="成山路"></div>
					<div class="s8-19 station" station-name="杨思"></div>
					<div class="s8-21 station" station-name="凌兆新村"></div>
					<div class="s8-20 station" station-name="东方体育中心"></div>
					<div class="s8-22 station" station-name="芦恒路"></div>
					<div class="s8-23 station" station-name="浦江镇"></div>
					<div class="s8-24 station" station-name="江月路"></div>
					<div class="s8-25 station" station-name="联航路"></div>
					<div class="s8-26 station" station-name="沈杜公路"></div>

					<!-- 16号线   begin -->
					<div class="s16-1 station" station-name="滴水湖"></div>
					<div class="s16-2 station" station-name="临港大道"></div>
					<div class="s16-3 station" station-name="书院"></div>
					<div class="s16-4 station" station-name="惠南东"></div>
					<div class="s16-5 station" station-name="惠南"></div>
					<div class="s16-6 station" station-name="野生动物园"></div>
					<div class="s16-7 station" station-name="新场"></div>
					<div class="s16-8 station" station-name="航头东"></div>
					<div class="s16-9 station" station-name="鹤沙航城"></div>
					<div class="s16-10 station" station-name="周浦东"></div>
					<div class="s16-11 station" station-name="罗山路"></div>
					<div class="s16-12 station" station-name="华夏中路"></div>
					<!-- 16号线 end -->
					
					<!-- 13 begin-->
					<div class="s13-1 station" station-name="世博大道"></div>
					<div class="s13-2 station" station-name="世博会博物馆"></div>
					<div class="s13-3 station" station-name="马当路"></div>
					<div class="s13-4 station" station-name="新天地"></div>
					<div class="s13-5 station" station-name="淮海中路"></div>
					<div class="s13-7 station" station-name="自然博物馆"></div>
					<div class="s13-9 station" station-name="江宁路"></div>
					<div class="s13-11 station" station-name="武宁路"></div>
					<div class="s13-12 station" station-name="隆德路"></div>
					<div class="s13-14 station" station-name="大渡河路"></div>
					<div class="s13-15 station" station-name="真北路"></div>
					<div class="s13-16 station" station-name="祁连山南路"></div>
					<div class="s13-17 station" station-name="丰庄"></div>
					<div class="s13-18 station" station-name="金沙江西路"></div>
					<div class="s13-19 station" station-name="金运路"></div>
					<!-- 13 end-->
					
					<!-- 11 begin -->
					<div class="s11-1 station" station-name="迪士尼"></div>
					<div class="s11-2 station" station-name="康新公路"></div>
					<div class="s11-3 station" station-name="秀沿路"></div>
					<div class="s11-4 station" station-name="御桥"></div>
					<div class="s11-5 station" station-name="浦三路"></div>
					<div class="s11-6 station" station-name="三林东"></div>
					<div class="s11-7 station" station-name="三林"></div>
					<div class="s11-8 station" station-name="龙耀路"></div>
					<div class="s11-9 station" station-name="云锦路"></div>
					<div class="s11-10 station" station-name="上海游泳馆"></div>
					<div class="s11-11 station" station-name="枫桥路"></div>
					<div class="s11-12 station" station-name="真如"></div>
					<div class="s11-13 station" station-name="上海西站"></div>
					<div class="s11-14 station" station-name="李子园"></div>
					<div class="s11-15 station" station-name="祁连山路"></div>
					<div class="s11-16 station" station-name="武威路"></div>
					<div class="s11-17 station" station-name="桃浦新村"></div>
					<div class="s11-18 station" station-name="南翔"></div>
					<div class="s11-19 station" station-name="马陆"></div>
					<div class="s11-20 station" station-name="嘉定新城"></div>
					<div class="s11-21 station" station-name="白银路"></div>
					<div class="s11-22 station" station-name="嘉定西"></div>
					<div class="s11-23 station" station-name="嘉定北"></div>

					<div class="s11-24 station" station-name="上海赛车场"></div>
					<div class="s11-25 station" station-name="昌吉东路"></div>
					<div class="s11-26 station" station-name="上海汽车城"></div>
					<div class="s11-27 station" station-name="安亭"></div>
					<div class="s11-28 station" station-name="兆丰路"></div>
					<div class="s11-29 station" station-name="光明路"></div>
					<div class="s11-30 station" station-name="花桥"></div>
					<!-- 11 end -->
					
					<!-- 12 begin -->
					<div class="s12-1 station" station-name="金海路"></div>
					<div class="s12-2 station" station-name="申江路"></div>
					<div class="s12-3 station" station-name="金京路"></div>
					<div class="s12-4 station" station-name="杨高北路"></div>
					<div class="s12-5 station" station-name="巨峰路"></div>
					<div class="s12-6 station" station-name="东陆路"></div>
					<div class="s12-7 station" station-name="复兴岛"></div>
					<div class="s12-8 station" station-name="爱国路"></div>
					<div class="s12-9 station" station-name="隆昌路"></div>
					<div class="s12-10 station" station-name="宁国路"></div>
					<div class="s12-11 station" station-name="江浦公园"></div>
					<div class="s12-13 station" station-name="提篮桥"></div>
					<div class="s12-14 station" station-name="国际客运中心"></div>
					<div class="s12-15 station" station-name="嘉善路"></div>
					<div class="s12-16 station" station-name="龙华"></div>
					<div class="s12-17 station" station-name="桂林公园"></div>
					<div class="s12-18 station" station-name="虹漕路"></div>
					<div class="s12-19 station" station-name="虹梅路"></div>
					<div class="s12-20 station" station-name="东兰路"></div>
					<div class="s12-21 station" station-name="顾戴路"></div>
					<div class="s12-22 station" station-name="虹莘路"></div>
					<div class="s12-23 station" station-name="七莘路"></div>
					<!-- 12 end -->
					
					<!-- 10 begin-->
					<div class="s10-1 station" station-name="航中路"></div>
					<div class="s10-2 station" station-name="紫藤路"></div>
					<div class="s10-3 station" station-name="龙柏新村"></div>
					<div class="s10-4 station" station-name="龙溪路"></div>
					<div class="s10-5 station" station-name="水城路"></div>
					<div class="s10-6 station" station-name="伊犁路"></div>
					<div class="s10-7 station" station-name="宋园路"></div>
					<div class="s10-9 station" station-name="交通大学"></div>
					<div class="s10-10 station" station-name="上海图书馆"></div>
					<div class="s10-12 station" station-name="豫园"></div>
					
					<div class="s10-14 station" station-name="天潼路"></div>
					<div class="s10-15 station" station-name="四川北路"></div>
					<div class="s10-17 station" station-name="邮电新村"></div>
					<div class="s10-19 station" station-name="同济大学"></div>
					<div class="s10-20 station" station-name="国权路"></div>
					<div class="s10-21 station" station-name="五角场"></div>
					<div class="s10-22 station" station-name="江湾体育场"></div>
					<div class="s10-23 station" station-name="三门路"></div>
					<div class="s10-24 station" station-name="殷高东路"></div>
					<div class="s10-25 station" station-name="新江湾城"></div>
					
					<div class="s10-26 station" station-name="上海动物园"></div>
					<div class="s10-27 station" station-name="虹桥1号航站楼"></div>
					<!-- 10 end-->
					
					<!-- 9 begin -->
					<div class="s9-1 station" station-name="松江南站"></div>
					<div class="s9-2 station" station-name="醉白池"></div>
					<div class="s9-3 station" station-name="松江体育中心"></div>
					<div class="s9-4 station" station-name="松江新城"></div>
					<div class="s9-5 station" station-name="松江大学城"></div>
					<div class="s9-6 station" station-name="洞泾"></div>
					<div class="s9-7 station" station-name="佘山"></div>
					<div class="s9-8 station" station-name="泗泾"></div>
					<div class="s9-9 station" station-name="九亭"></div>
					<div class="s9-10 station" station-name="中春路"></div>
					<div class="s9-11 station" station-name="七宝"></div>
					<div class="s9-12 station" station-name="星中路"></div>
					<div class="s9-13 station" station-name="合川路"></div>
					<div class="s9-14 station" station-name="漕河泾开发区"></div>
					<div class="s9-15 station" station-name="桂林路"></div>
					<div class="s9-16 station" station-name="打浦桥"></div>
					<div class="s9-17 station" station-name="小南门"></div>
					<div class="s9-18 station" station-name="商城路"></div>
					<div class="s9-19 station" station-name="杨高中路"></div>
					<!-- 9 end -->
					
					<!-- <div class="tips-info" style="left: 150px; top: 915px; display: block;">
						<div class="tips-box">
							<div class="tips-overflow">
								<p>时间：<em>7:50:45</em></p>
								<p>地铁站：<em id="station-name">江杨北路</em></p>
								<p>车厢：<em>3</em></p>
								<p>广告爆光：<em>KFC</em></p>
								<p>App：<em>爱奇艺</em></p>
							</div>
						</div>
					</div> -->

				</div>
			</div>
			<div style="display: none;" id="data-list"></div>
			<!-- subway end  -->
		</div>
	</div>
</div>
<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="js/parallax.js"></script>
<script>
	$(function(){
		var i=0;
	    var time;
		var sta_name;
		var index;
		var isfirst=true;
		var sta_x;//行为轨迹的点心中的y值
		var sta_y;//行为轨迹的点心中的X值
		var isplay =false;
		var offset_x;
		var offset_y;
		var more_width =(parseInt($(window).width())-1440)/2;
		//获取Canvas对象(画布)
		var canvas = document.getElementById("myCanvas");
		var stationTimeout;
		$(".station").hover(function(){
			if(!isplay&&$(this).hasClass('act')){
				clearTimeout(stationTimeout);
				var station_name = $(this).attr("station-name");
				var obj = $(this);
				getUserAttr(station_name,obj,2);
			}
		},function(){
			if(!isplay&&$(this).hasClass('act')){
				stationTimeout = setTimeout(function(){$(".tips-info").hide();},100);
			}
		});
		$(".daily-action").on("mouseover",".tips-info",function(){
	      if(!isplay){clearTimeout(stationTimeout);}
	    });
	    $(".daily-action").on("mouseout",".tips-info",function(){
	      if(!isplay){stationTimeout = setTimeout(function(){$(".tips-info").hide();},100);}
	    });
	    
		SidebarTabHandler.Init();

		//getHotApp()
		//getHost();
	    //setInterval(getHost,5000);//每30分钟刷新一次热门APP榜
	    //播放人的行为轨迹
	    var stationList = '';
	    function playAction(){
			var index;
			stationList = JSON.parse($("#data-list").text());
			if(i<stationList.length){
				time = stationList[i].time;
				sta_name = stationList[i].station;
				console.log(time+"===="+sta_name);
				i++;
				index = time-6;
				if(index!="undefined"){
	            	$(".times span").removeClass('act').eq(index).addClass('act');
				}
				if(i==stationList.length){//当遍历到最后一个元素的时候 重新开始
					i=0;
				}
				//$(".subway-wrap").css({'background-image':'none'});
				isplay=true;
				if(i<stationList.length){
					$(".station").each(function(){
						var obj   = $(this);
						getUserAttr(sta_name,obj,1);
					});
				}
			}
		};

		//点击播放暂停
		var act_interval;
		$(".play-btn").click(function(){
			if($(this).hasClass('pause-btn')){//点击暂停
				$(this).removeClass('pause-btn').find("span").text("播放");
				clearInterval(act_interval);
			}else{//点击播放  
				$(this).addClass('pause-btn').find("span").text("暂停");
				playAction();
				act_interval = setInterval(playAction,5000);
				//$("#myCanvas").show();
			}
			//$(".close-btn").show();
		});
		//输入手机号码 点确认 显示行为轨迹
		$(".submit-btn").click(function(){
			var phone = $("#phone").val();
			//alert(phone);return;
			if(phone == ''){
				alert('请输入手机号或者设备号');
				return;
			}
			$.ajax({
		        type: "get",
		        url: apiUrl,
		        data: {'action':'userTrail','phone':phone},
		        dataType:'json',
		        success: function(data) {
		        	if(data.code == 1){
		        		$('.tel-version').html('<em>手机型号</em>&nbsp;'+data.model);
	        			$('.tel-interest').html('<em>兴趣爱好</em>&nbsp;'+data.interes);
		        		stationList = JSON.stringify(data.list);
		        		$("#data-list").text(stationList);
		        		initAction();
		        		$(".main-bg").css('height', '1650px');
		        	}
		        }
		    });
			$(".hot-app").hide();
			$(".daily-action").show();
		});


	    $(document).keydown(function(e) {  
          if (e.keyCode == 13) {  
                 $(".submit-btn").click();
          } 
        });	
		//initAction();
		//初始化的调用
		function initAction(){
			stationList = JSON.parse($("#data-list").text());
			for(var i=0;i<stationList.length;i++){
				var sta_name =stationList[i].station;
				$(".station").each(function(){
					if($(this).attr("station-name")===sta_name){
						$(this).addClass('act');
					}
				})
			}
		}

		var tel_index = 0;
		setPhone();
		setInterval(setPhone,90000);
		
		function setPhone(){
			if(tel_index==10){
				tel_index=0;
			}
			var tel =["15005345415","13405343657","13905345555","15005344856","15005341544","15005345985","15005342659","15005342659","15005349585","15005343365"];
			var str1= tel[tel_index].substring(0,3);
			var str2 =tel[tel_index].substring(7,11);
			$("#tel_change").html(str1+"****"+str2);
			
			$.ajax({
		        type: "get",
		        url: apiUrl,
		        data: {'action':'userTrail','phone':tel[tel_index]},
		        dataType:'json',
		        success: function(data) {
		        	if(data.code == 1){
		        		$('.tel-version').html('<em>手机型号</em>&nbsp;'+data.model);
	        			$('.tel-interest').html('<em>兴趣爱好</em>&nbsp;'+data.interes);
		        		stationList = JSON.stringify(data.list);
		        		$("#data-list").text(stationList);
		        		initAction();
		        		playAction();
						act_interval = setInterval(playAction,5000);
		        	}
		        }
		    });
		    tel_index++;
		}

	})
	//
	var SidebarTabHandler={
		Init:function(){
			$(".tabItemContainer>li").click(function(){
				$(".tabItemContainer>li").removeClass("tabItemCurrent");
				$(".tabBodyItem").removeClass("tabBodyCurrent");
				$(this).addClass("tabItemCurrent");
				$($(".tabBodyItem")[$(this).index()]).addClass("tabBodyCurrent");
			});
		}
	}
	function getUserAttr(stationName,obj,type){
		stationList = JSON.parse($("#data-list").text());
		var daily =obj.parents(".daily-action");
		var $this_left = parseInt(obj.css("left"))-32;
		var $this_top = parseInt(obj.css("top"))+13-216+350;
		for(var i=0;i<stationList.length;i++){
			var sta_name =stationList[i].station;
			if(stationName == sta_name){
				//console.log(stationName+'##'+stationList[i].app);
				if(type==1 && obj.attr("station-name")!==stationName){
        			return;
        		}
				if($(".tips-info").length==0){
					daily.append('<div class="tips-info "><div class="tips-box"><div class="tips-overflow">'+
							   '<p>时间：<em id="station_time">7:50:45</em></p>'+
							   '<p>地铁站：<em id="station_name"></em></p>'+
							   '<p>广告爆光：<em id="dmp"></em></p>'+
							   '<p>App：<em id="app1"></em></p></div></div></div>');
				}else{
					$(".tips-info").show();
				}
				//alert(stationList[i].dmp);
				$("#station_time").text(stationList[i].dTime);
				$("#station_name").text(stationName);
				$("#dmp").text(stationList[i].dmp);
				$("#app1").text(stationList[i].app);
				$(".tips-info").css({"left":$this_left+"px","top":$this_top+"px"});
			}
		}
	}
	//getHost();
	function getHost(){
		$.ajax({
	        type: "get",
	        url: apiUrl,
	        data: {'action':'hot'},
	        dataType:'json',
	        success: function(data) {
	        	var html = '<tr><th class="">排名</th><th class="">名称</th><th>当前用户数</th><th>热度</th></tr>';
	        	$("#app").empty().append(html+data.appList);
	        	$("#url").empty().append(html+data.urlList);
	        	 getRandomArray();
 				 addHot();
	        }
	    });
	}

  var index;
  var arrIndex;
  function arr(){
    index = Math.floor(Math.random()*10);
  }
  function getRandomArray(){
    arr();
    // console.log(index)
         arrIndex = new Array(7)
        .fill(0)
        .map((v,i)=>i+1)
        .sort(()=>0.5 - Math.random())
        .filter((v,i)=>i<index);
        console.log(arrIndex);
        return arrIndex;
        
    }
  function addHot(){
    for(var i=0;i<arrIndex.length;i++){
        // console.log($(".tabBodyCurrent .content").eq());
        var x = arrIndex[i];
        var y = Math.floor(Math.random()*2);
        if(y==0){
            $(".tabBodyCurrent .content").eq((x+2)).children("td:nth-child(2)").children("em").removeAttr('class').addClass("hot");
        }else{
          $(".tabBodyCurrent .content").eq((x+2)).children("td:nth-child(2)").children("em").removeAttr('class').addClass("new");
        }
      }

  }
  
  //tab change
  var SidebarTabHandler={
    Init:function(){
      $(".tabItemContainer>li").click(function(){
        //alert($(this).html());
        if(!$(this).hasClass('tabItemCurrent')){
          $(".tabItemContainer>li").removeClass("tabItemCurrent");
          $(".tabBodyItem").removeClass("tabBodyCurrent");
          $(this).addClass("tabItemCurrent");
          $($(".tabBodyItem")[$(this).index()]).addClass("tabBodyCurrent");
          getRandomArray();
          addHot();
        }
      });
    }
  }
</script>
</body>
</html>