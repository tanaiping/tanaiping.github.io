<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>花生地铁大数据</title>
	<link rel="stylesheet" href="css/base.css" />
	<link rel="stylesheet" href="css/subway.css" />
</head>
<body>
<div class="main-bg">
	<div class="main-wrap">
		<div class="subway-star">
			<div class="flow-wrap">
				<div class="title">站点流向人数 TOP10</div>
				<h3>站点流向<em>人数</em></h3>
				<ul>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">富锦路-中华北路</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">四平路-人民广场</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">佘山-宝山路</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">佘山-小南门</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">中山公园-陕西南路</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">-中华北路</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">富锦路-中华北路</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">富锦路-中华北路</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">富锦路-中华北路</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
					<li>
						<div class="flow-person"> 
							<span class="station-flow">富锦路-中华北路</span>
							<em class="station-num">115</em>
						</div>
						<div class="percent"><em style="width: 60%;"></em></div>
					</li>
				</ul>
			</div>
			<!-- 用户覆盖数 end  -->
			<div class="subway-wrap subway-opacity">
				<div id="main" style="width: 1460px;height:1188px;"></div>
				<div class="s1-1 station-box" station-name="广州东站"></div>
				<div class="s1-2 station-box" station-name="体育中心"></div>
				<div class="s1-3 station-box" station-name="体育西路"></div>
				<div class="s1-4 station-box" station-name="杨箕"></div>
				<div class="s1-5 station-box" station-name="东山口"></div>
				<div class="s1-6 station-box" station-name="烈士陵园"></div>
				<div class="s1-7 station-box" station-name="农讲所"></div>
				<div class="s1-8 station-box" station-name="公园前"></div>
				<div class="s1-9 station-box" station-name="西门口"></div>
				<div class="s1-10 station-box" station-name="陈家祠"></div>
				<div class="s1-11 station-box" station-name="长寿路"></div>
				<div class="s1-12 station-box" station-name="黄沙"></div>
				<div class="s1-13 station-box" station-name="芳村"></div>
				<div class="s1-14 station-box" station-name="花地湾"></div>
				<div class="s1-15 station-box" station-name="坑口"></div>
				<div class="s1-16 station-box" station-name="西朗"></div>

				<div class="s2-1 station-box" station-name="嘉禾望岗"></div>
				<div class="s2-2 station-box" station-name="黄边"></div>
				<div class="s2-3 station-box" station-name="江夏"></div>
				<div class="s2-4 station-box" station-name="萧岗"></div>
				<div class="s2-5 station-box" station-name="白云文化广场"></div>
				<div class="s2-6 station-box" station-name="白云公园"></div>
				<div class="s2-7 station-box" station-name="飞翔公园"></div>
				<div class="s2-8 station-box" station-name="三元里"></div>
				<div class="s2-9 station-box" station-name="广州火车站"></div>
				<div class="s2-10 station-box" station-name="越秀公园"></div>
				<div class="s2-11 station-box" station-name="纪念堂"></div>
				<div class="s2-12 station-box" station-name="海珠广场"></div>
				<div class="s2-13 station-box" station-name="市二宫"></div>
				<div class="s2-14 station-box" station-name="江南西"></div>
				<div class="s2-15 station-box" station-name="昌岗"></div>
				<div class="s2-16 station-box" station-name="江泰路"></div>
				<div class="s2-17 station-box" station-name="东晓南"></div>
				<div class="s2-18 station-box" station-name="南洲"></div>
				<div class="s2-19 station-box" station-name="洛溪"></div>
				<div class="s2-20 station-box" station-name="南浦"></div>
				<div class="s2-21 station-box" station-name="会江"></div>
				<div class="s2-22 station-box" station-name="石壁"></div>
				<div class="s2-23 station-box" station-name="广州南站"></div>

				<div class="s3-1 station-box" station-name="天河客运站"></div>
				<div class="s3-2 station-box" station-name="五山"></div>
				<div class="s3-3 station-box" station-name="华师"></div>
				<div class="s3-4 station-box" station-name="岗顶"></div>
				<div class="s3-5 station-box" station-name="石牌桥"></div>
				<div class="s3-6 station-box" station-name="珠江新城"></div>
				<div class="s3-7 station-box" station-name="广州塔"></div>
				<div class="s3-8 station-box" station-name="客村"></div>
				<div class="s3-9 station-box" station-name="大塘"></div>
				<div class="s3-10 station-box" station-name="沥滘"></div>
				<div class="s3-11 station-box" station-name="厦滘"></div>
				<div class="s3-12 station-box" station-name="大石"></div>
				<div class="s3-13 station-box" station-name="汉溪长隆"></div>
				<div class="s3-14 station-box" station-name="市桥"></div>
				<div class="s3-15 station-box" station-name="番禺广场"></div>
				<div class="s3-16 station-box" station-name="林和西"></div>
				<div class="s3-17 station-box" station-name="燕塘"></div>
				<div class="s3-18 station-box" station-name="梅花园"></div>
				<div class="s3-19 station-box" station-name="京溪南方医院"></div>
				<div class="s3-20 station-box" station-name="同和"></div>
				<div class="s3-21 station-box" station-name="永泰"></div>
				<div class="s3-22 station-box" station-name="白云大道北"></div>
				<div class="s3-23 station-box" station-name="龙归"></div>
				<div class="s3-24 station-box" station-name="人和"></div>
				<div class="s3-25 station-box" station-name="高增"></div>
				<div class="s3-26 station-box" station-name="机场南(1号航站楼)"></div>
				<div class="s3-27 station-box" station-name="机场北(2号航站楼)"></div>

				<div class="s4-1 station-box" station-name="南沙客运港"></div>
				<div class="s4-2 station-box" station-name="南横"></div>
				<div class="s4-3 station-box" station-name="塘坑"></div>
				<div class="s4-4 station-box" station-name="大涌"></div>
				<div class="s4-5 station-box" station-name="广隆"></div>
				<div class="s4-6 station-box" station-name="飞沙角"></div>
				<div class="s4-7 station-box" station-name="金洲"></div>
				<div class="s4-8 station-box" station-name="蕉门"></div>
				<div class="s4-9 station-box" station-name="黄阁"></div>
				<div class="s4-10 station-box" station-name="黄阁汽车城"></div>
				<div class="s4-11 station-box" station-name="庆盛"></div>
				<div class="s4-12 station-box" station-name="东涌"></div>
				<div class="s4-13 station-box" station-name="低涌"></div>
				<div class="s4-14 station-box" station-name="海傍"></div>
				<div class="s4-15 station-box" station-name="石碁"></div>
				<div class="s4-16 station-box" station-name="新造"></div>
				<div class="s4-17 station-box" station-name="大学城南"></div>
				<div class="s4-18 station-box" station-name="大学城北"></div>
				<div class="s4-19 station-box" station-name="官洲"></div>
				<div class="s4-20 station-box" station-name="万胜围"></div>
				<div class="s4-21 station-box" station-name="车陂南"></div>
				<div class="s4-22 station-box" station-name="车陂"></div>
				<div class="s4-23 station-box" station-name="黄村"></div>

				<div class="s5-1 station-box" station-name="文冲"></div>
				<div class="s5-2 station-box" station-name="大沙东"></div>
				<div class="s5-3 station-box" station-name="大沙地"></div>
				<div class="s5-4 station-box" station-name="鱼珠"></div>
				<div class="s5-5 station-box" station-name="三溪"></div>
				<div class="s5-6 station-box" station-name="东圃"></div>
				<div class="s5-7 station-box" station-name="科韵路"></div>
				<div class="s5-8 station-box" station-name="员村"></div>
				<div class="s5-9 station-box" station-name="潭村"></div>
				<div class="s5-10 station-box" station-name="猎德"></div>
				<div class="s5-11 station-box" station-name="五羊邨"></div>
				<div class="s5-12 station-box" station-name="动物园"></div>
				<div class="s5-13 station-box" station-name="区庄"></div>
				<div class="s5-14 station-box" station-name="淘金"></div>
				<div class="s5-15 station-box" station-name="小北"></div>
				<div class="s5-16 station-box" station-name="西村"></div>
				<div class="s5-17 station-box" station-name="西场"></div>
				<div class="s5-18 station-box" station-name="中山八"></div>
				<div class="s5-19 station-box" station-name="坦尾"></div>
				<div class="s5-20 station-box" station-name="滘口"></div>

				<div class="s6-1 station-box" station-name="浔峰岗"></div>
				<div class="s6-2 station-box" station-name="横沙"></div>
				<div class="s6-3 station-box" station-name="沙贝"></div>
				<div class="s6-4 station-box" station-name="河沙"></div>
				<div class="s6-5 station-box" station-name="坦尾"></div>
				<div class="s6-6 station-box" station-name="如意坊"></div>
				<div class="s6-7 station-box" station-name="文化公园"></div>
				<div class="s6-8 station-box" station-name="一德路"></div>
				<div class="s6-9 station-box" station-name="北京路"></div>
				<div class="s6-10 station-box" station-name="团一大广场"></div>
				<div class="s6-11 station-box" station-name="东湖"></div>
				<div class="s6-12 station-box" station-name="黄花岗"></div>
				<div class="s6-13 station-box" station-name="沙河顶"></div>
				<div class="s6-14 station-box" station-name="天平架"></div>
				<div class="s6-15 station-box" station-name="长湴"></div>
				<div class="s6-16 station-box" station-name="植物园"></div>
				<div class="s6-17 station-box" station-name="龙洞"></div>
				<div class="s6-18 station-box" station-name="柯木塱"></div>
				<div class="s6-19 station-box" station-name="高塘石"></div>
				<div class="s6-20 station-box" station-name="黄陂"></div>
				<div class="s6-21 station-box" station-name="金峰"></div>
				<div class="s6-22 station-box" station-name="暹岗"></div>
				<div class="s6-23 station-box" station-name="苏元"></div>
				<div class="s6-24 station-box" station-name="萝岗"></div>
				<div class="s6-25 station-box" station-name="香雪"></div>


				<div class="s7-1 station-box" station-name="板桥"></div>
				<div class="s7-2 station-box" station-name="员岗"></div>
				<div class="s7-3 station-box" station-name="南村万博"></div>
				<div class="s7-4 station-box" station-name="钟村"></div>
				<div class="s7-5 station-box" station-name="谢村"></div>

				<div class="s8-1 station-box" station-name="琶洲"></div>
				<div class="s8-2 station-box" station-name="新港东"></div>
				<div class="s8-3 station-box" station-name="磨碟沙"></div>
				<div class="s8-4 station-box" station-name="赤岗"></div>
				<div class="s8-5 station-box" station-name="鹭江"></div>
				<div class="s8-6 station-box" station-name="中大"></div>
				<div class="s8-7 station-box" station-name="晓港"></div>
				<div class="s8-8 station-box" station-name="宝岗大道"></div>
				<div class="s8-9 station-box" station-name="沙园"></div>
				<div class="s8-10 station-box" station-name="凤凰新村"></div>


				<!-- 9 begin -->
				<div class="s9-1 station-box" station-name="清布"></div>
				<div class="s9-2 station-box" station-name="莲塘"></div>
				<div class="s9-3 station-box" station-name="马鞍山公园"></div>
				<div class="s9-4 station-box" station-name="花都广场"></div>
				<div class="s9-5 station-box" station-name="花果山公园"></div>
				<div class="s9-6 station-box" station-name="花城路"></div>
				<div class="s9-7 station-box" station-name="广州北站"></div>
				<div class="s9-8 station-box" station-name="花都汽车城"></div>
				<div class="s9-9 station-box" station-name="飞鹅岭"></div>
				<!-- 9 end -->
				
				<!-- 广佛线 -->
				<div class="s10-1 station-box" station-name="燕岗"></div>
				<div class="s10-2 station-box" station-name="沙涌"></div>
				<div class="s10-3 station-box" station-name="鹤洞"></div>
				<div class="s10-4 station-box" station-name="菊树"></div>
				<div class="s10-5 station-box" station-name="龙溪"></div>
				<div class="s10-6 station-box" station-name="金融高新区"></div>
				<div class="s10-7 station-box" station-name="千灯湖"></div>
				<div class="s10-8 station-box" station-name="礌岗"></div>
				<div class="s10-9 station-box" station-name="南桂路"></div>
				<div class="s10-10 station-box" station-name="桂城"></div>
				<div class="s10-11 station-box" station-name="朝安"></div>
				<div class="s10-12 station-box" station-name="普君北路"></div>
				<div class="s10-13 station-box" station-name="祖庙"></div>
				<div class="s10-14 station-box" station-name="同济路"></div>
				<div class="s10-15 station-box" station-name="季华园"></div>
				<div class="s10-16 station-box" station-name="魁奇路"></div>
				<div class="s10-17 station-box" station-name="澜石"></div>
				<div class="s10-18 station-box" station-name="世纪莲"></div>
				<div class="s10-19 station-box" station-name="东平"></div>
				<div class="s10-20 station-box" station-name="新城东"></div>

				<!-- APM -->
				<div class="s11-1 station-box" station-name="海心沙"></div>
				<div class="s11-2 station-box" station-name="大剧院"></div>
				<div class="s11-3 station-box" station-name="花城大道"></div>
				<div class="s11-4 station-box" station-name="妇儿中心"></div>
				<div class="s11-5 station-box" station-name="黄埔大道"></div>
				<div class="s11-6 station-box" station-name="天河南"></div>
				<div class="s11-7 station-box" station-name="体育中心南"></div>

				<!-- 知识城线 -->
				<div class="s12-1 station-box" station-name="镇龙"></div>
				<div class="s12-2 station-box" station-name="镇龙北"></div>
				<div class="s12-3 station-box" station-name="汤村"></div>
				<div class="s12-4 station-box" station-name="旺村"></div>
				<div class="s12-5 station-box" station-name="何棠下"></div>
				<div class="s12-6 station-box" station-name="知识城"></div>
				<div class="s12-7 station-box" station-name="枫下"></div>
				<div class="s12-8 station-box" station-name="新南"></div>
				<div class="s12-9 station-box" station-name="红卫"></div>
				<div class="s12-10 station-box" station-name="新和"></div>
				
				<!-- 13 begin-->
				<div class="s13-1 station-box" station-name="新沙"></div>
				<div class="s13-2 station-box" station-name="官湖"></div>
				<div class="s13-3 station-box" station-name="新塘"></div>
				<div class="s13-4 station-box" station-name="白江"></div>
				<div class="s13-5 station-box" station-name="沙村"></div>
				<div class="s13-6 station-box" station-name="南岗"></div>
				<div class="s13-7 station-box" station-name="夏园"></div>
				<div class="s13-8 station-box" station-name="南海神庙"></div>
				<div class="s13-9 station-box" station-name="双岗"></div>
				<div class="s13-10 station-box" station-name="裕丰围"></div>
				<!-- 13 end-->
				
			</div>
		</div>
		<!-- subway end  -->
	</div>
</div>
<script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="js/echarts.min.js"></script>
<script type="text/javascript" src="js/jquery.easing.1.3.js"></script>
<script>
	$(function(){
		getUserData();
		setInterval(getUserData,3000);

		//
		function getUserData(){
			var mydate = new Date();
			var h = mydate.getHours(); //获取当前小时数(0-23)
			var m = mydate.getMinutes(); //获取当前分钟数(0-59)
			var s = mydate.getSeconds(); //获取当前秒数(0-59)
			if (h<10) {h = "0" +h;}
	        if (m<10) {m = "0" +m;}
	        if (s<10) {s = "0" +s;}
			var time_text = h+":"+m+":"+s;
			$("#time").text(time_text);
		}

		//移入站点出来站点名称以及人数,移出隐藏
		var stationTimeout;
		$(".station").hover(function(){
			clearTimeout(stationTimeout);
			var obj = $(this).parents(".subway-wrap");
			var $this_left = parseInt($(this).css("left"))-87;
			var $this_top = parseInt($(this).css("top"))+13-128;
			if($(".tips-station").length==0){
				obj.append('<div class="tips-station"><div class="tips-box">'+
						   '<p>站台：<em id="station_name"></em></p>'+
						   '<p>人数：<em>153254</em></p></div></div>');
			}else{
				$(".tips-station").show();
			}
			$("#station_name").text($(this).attr("station-name"));
			$(".tips-station").css({"left":$this_left+"px","top":$this_top+"px"});
		},function(){
			stationTimeout = setTimeout(function(){$(".tips-station").hide();},100);
		});
		$(".subway-wrap").on("mouseover",".tips-station",function(){
	      clearTimeout(stationTimeout);
	    });
	    $(".subway-wrap").on("mouseout",".tips-station",function(){
	      stationTimeout = setTimeout(function(){$(".tips-station").hide();},100);
	    });


		// 基于准备好的dom，初始化echarts图表
    var myChart = echarts.init(document.getElementById('main'));
    var  data = []; 
    var coords = []; 
    
	var links = [];

	var colors = ['#44fd20', '#20fd92', '#20f0fd', '#f5fd20', '#7320fd', '#fdf020', '#e80c9d', '#e80c9d', '#fb048f', '#e80c21', '#fb0404'];

	function getColorPalette(i) {
	    return colors[i];
	}
		var option = {
		    title: {
		        text: ''
		    },
		    tooltip: {},
		    xAxis: {
		        show: false,
		        // type : 'category',
		        // boundaryGap : false,
		        // data : axisData
		        type: 'value',
		        min: 0,
		        max: 1460,
		    },
		    yAxis: {
		        show: false,
		        type: 'value',
		        min: 0,
		        max: 1188,
		        inverse: true
		    },
		    dataRange: {
		        min: 0,
		        max: 600,
		        y: '60%',
		        calculable: true,
		        color: ['#d20528', 'orange', 'yellow', 'lime', 'aqua'],
		        show:false
		    },
		    grid: {
		          containLabel: true,
		          top: '0',
		          bottom: '-20',
		          left: '-35',
		          right: '0'
		      },
		    series: [{
		        type: 'effectScatter',  //波纹 graph effectScatter
		        // rippleEffect: {
		        //     brushType: 'stroke'
		        // },
		        layout: 'none',
		        roam:true,
		        coordinateSystem: 'cartesian2d',
		        symbolSize: 12,
		        edgeSymbol: ['none', 'arrow'], // ['none', 'arrow'] ['circle', 'arrow']
		        edgeSymbolSize: [2, 10],
		        data: data,
		        links: links,
		        label: {
		            normal: {
		                show: true,
		                position: 'right',//显示位置
		                offset:[5, 0], //偏移设置
		                formatter: '{b}', //圆环显示文字
		                color:"#00FFFC",
		                fontSize:14
		            },
		            emphasis: {
		              show: true,
		            }
		        }
		    }, {
		        name: '',
		        type: 'lines',
		        coordinateSystem: 'cartesian2d',
		        zlevel: 1,
			    effect: {
		              show: true,
		              period: 3,
		              trailLength: 0.01,
		              symbolSize: 13,
		              symbol: "triangle",
		              //color:'rgba(55,155,255,0.5)'
		          },
		        lineStyle: {
		            normal: {
		                color: new echarts.graphic.LinearGradient(0, 0, 1, 0, [{
		                    offset: 0,
		                    color: 'rgb(255, 0, 0)'
		                }, {
		                    offset: 1,
		                    color: 'rgb(0, 255, 0)'
		                }]),
		                color:'#a0a0a0',
		                color: function() {
		                    return getColorPalette(3);
		                }(),
		                width: 2,
		                opacity: 0.6,
		                curveness: 0.2,//贝塞尔曲线度
		                type:"dotted"
		            }
		        },
		        data: coords
		    }]
		};
   
	getEchartsData();
	setInterval(getEchartsData,18000);
    // 为echarts对象加载数据 
    myChart.setOption(option); 

    	//获取echarts数据 并组装数据
    	function getEchartsData(){
    		 var stationData = ["珠江新城","体育西路","体育西路","珠江新城","客村","珠江新城","客村","体育西路","市桥","长寿路","体育西路","林和西","大石","珠江新城","市桥","体育西路","体育西路","石牌桥","车陂南","珠江新城","体育西路","长寿路","汉溪长隆","珠江新城","昌岗","沙园","龙归","体育西路","客村","昌岗","公园前","体育西路","昌岗","公园前","昌岗","客村","车陂南","万胜围","汉溪长隆","体育西路"];
    	         var valueData =[1474,1430,1166,1001,957,836,825,814,726,704,693,671,638,638,627,594,594,594,594,583];
    	         console.log(stationData)
		        console.log(valueData)
		    //组装data数据
		    for(var y=0;y<stationData.length;y++){
		    	var param =[];
		    	var sta_name =stationData[y];
		    	$(".station-box").each(function(){
					if($(this).attr("station-name")===sta_name){
						var left = parseInt($(this).css("left"))+8;
						var top = parseInt($(this).css("top"))+10;
						param.push(left);
						param.push(top);
					}
				})
				data.push({"name":stationData[y],"value":param});
		    }
		     console.log( JSON.stringify(data));
		    //组装画线的数据
		    for(var x=0;x<data.length;x+=2){
		    	var coord1 = [];
		    	var coord2 = [];
		    	var coord = [];
		    	// var coord = [];
		    	var left1 = data[x].value[0];
		    	var top1 = data[x].value[1];
		    	coord1.push(left1);
		    	coord1.push(top1);
		    	coord.push({"coord":coord1});
		    	left1 = data[(x+1)].value[0];
		    	top1 = data[(x+1)].value[1];
		    	coord2.push(left1);
		    	coord2.push(top1);
		    	coord.push({"coord":coord2,"value":valueData[x/2]});
		    	coords.push(coord);
		    }
		    console.log( JSON.stringify(coords)+"====coords");
    	}

    	
	})
</script>
</body>
</html>